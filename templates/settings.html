{% extends 'base.html' %}

{% block content %}
{% set can_edit = session.get('can_edit', 1) %}

<div class="app-card p-3 p-md-4">
  <h4 class="mb-3">Regles d'appreciation</h4>

  {% if not can_edit %}
  <div class="alert alert-warning py-2">Mode lecture seule: modification des appreciations desactivee.</div>
  {% endif %}

  <form method="POST">
    {{ csrf_field() }}
    <div class="table-responsive">
      <table class="table table-sm align-middle mb-0">
        <thead>
          <tr>
            <th>Min</th>
            <th>Max</th>
            <th>Message</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="rulesTable">
          {% for rule in rules %}
          <tr>
            <td><input type="number" step="0.01" name="min_val" value="{{ rule.min_val }}" class="form-control form-control-sm" {% if not can_edit %}readonly{% endif %}></td>
            <td><input type="number" step="0.01" name="max_val" value="{{ rule.max_val }}" class="form-control form-control-sm" {% if not can_edit %}readonly{% endif %}></td>
            <td><input type="text" name="message" value="{{ rule.message }}" class="form-control form-control-sm" {% if not can_edit %}readonly{% endif %}></td>
            <td><button type="button" class="btn btn-outline-danger btn-sm" onclick="this.closest('tr').remove()" {% if not can_edit %}disabled{% endif %}>X</button></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="d-flex gap-2 mt-3">
      <button type="button" class="btn btn-secondary btn-sm" onclick="addRule()" {% if not can_edit %}disabled{% endif %}>Ajouter</button>
      <button type="submit" class="btn btn-success btn-sm" {% if not can_edit %}disabled{% endif %}>Enregistrer</button>
    </div>
  </form>
</div>

<script>
  function addRule() {
    if (!{{ 'true' if can_edit else 'false' }}) return;
    var table = document.getElementById('rulesTable');
    var row = table.insertRow();
    row.innerHTML = '<td><input type=\"number\" step=\"0.01\" name=\"min_val\" class=\"form-control form-control-sm\"></td><td><input type=\"number\" step=\"0.01\" name=\"max_val\" class=\"form-control form-control-sm\"></td><td><input type=\"text\" name=\"message\" class=\"form-control form-control-sm\"></td><td><button type=\"button\" class=\"btn btn-outline-danger btn-sm\" onclick=\"this.closest(\\'tr\\').remove()\">X</button></td>';
  }
</script>
{% endblock %}
