{% extends 'base.html' %}

{% block content %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<style>
    /* STYLE MODERNE */
    .stat-card-modern { background-color: #1e1e1e; border: 1px solid #333; border-radius: 12px; transition: 0.3s; }
    .stat-card-modern:hover { transform: translateY(-5px); border-color: #555; }
    .icon-box { width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-left: 15px; }
    .bg-icon-blue { background-color: rgba(13, 110, 253, 0.2); color: #0d6efd; }
    .bg-icon-green { background-color: rgba(25, 135, 84, 0.2); color: #198754; }
    .bg-icon-purple { background-color: rgba(111, 66, 193, 0.2); color: #6f42c1; }
    .bg-icon-orange { background-color: rgba(253, 126, 20, 0.2); color: #fd7e14; }
    
    .table-responsive { overflow-x: auto; background-color: #1e1e1e; border-radius: 8px; }
    .input-note { min-width: 55px; font-weight: bold; background-color: #121212 !important; border: 1px solid #444 !important; color: white !important; text-align: center; border-radius: 6px; height: 35px; }
    .input-note:focus { border-color: #d63384 !important; }
</style>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="text-white fw-bold mb-0 fs-4">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© <span class="text-primary small">(Tableau)</span></h2>
        <p class="text-white-50 small mb-0">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ {{ nom_prof }} ğŸ‘‹</p>
    </div>
    <span class="badge bg-dark border border-secondary fs-6 px-3 py-2 rounded-3">ğŸ“… 2025/2026</span>
</div>

{% if eleves %}
<div class="row g-3 mb-4">
    <div class="col-6 col-md-3"><div class="card stat-card-modern h-100 p-3"><div class="d-flex align-items-center"><div class="icon-box bg-icon-blue"><i class="bi bi-bar-chart-fill"></i></div><div><h6 class="text-white-50 small mb-1">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…</h6><h3 class="fw-bold text-white mb-0">{{ stats.moyenne_generale }}</h3></div></div></div></div>
    <div class="col-6 col-md-3"><div class="card stat-card-modern h-100 p-3"><div class="d-flex align-items-center"><div class="icon-box bg-icon-green"><i class="bi bi-patch-check-fill"></i></div><div><h6 class="text-white-50 small mb-1">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­</h6><h3 class="fw-bold text-success mb-0">{{ stats.taux_reussite }}%</h3></div></div></div></div>
    <div class="col-6 col-md-3"><div class="card stat-card-modern h-100 p-3"><div class="d-flex align-items-center"><div class="icon-box bg-icon-orange"><i class="bi bi-people-fill"></i></div><div><h6 class="text-white-50 small mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø§Ø¬Ø­ÙŠÙ†</h6><h3 class="fw-bold text-white mb-0">{{ stats.nb_admis }} <span class="fs-6 text-white-50 fw-normal">/ {{ stats.nb_total }}</span></h3></div></div></div></div>
    <div class="col-6 col-md-3"><div class="card stat-card-modern h-100 p-3"><div class="d-flex align-items-center"><div class="icon-box bg-icon-purple"><i class="bi bi-trophy-fill"></i></div><div class="w-100"><div class="d-flex justify-content-between w-100"><span class="text-white-50 small">Max:</span><span class="fw-bold text-success">{{ stats.meilleure_note }}</span></div><div class="d-flex justify-content-between w-100"><span class="text-white-50 small">Min:</span><span class="fw-bold text-danger">{{ stats.pire_note }}</span></div></div></div></div></div>
</div>
{% endif %}

{% if eleves %}
<div class="card shadow-sm mb-4 border-0" style="background-color: #1e1e1e; border-radius: 10px;">
    <div class="card-header bg-dark border-bottom border-secondary d-flex justify-content-between align-items-center py-2 px-3 rounded-top">
        <h6 class="mb-0 text-white">Statistiques avancÃ©es</h6>
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-12 col-lg-6">
                <div class="text-white-50 small mb-2">Moyenne par classe</div>
                <canvas id="chartClasses" height="180"></canvas>
            </div>
            <div class="col-12 col-lg-6">
                <div class="text-white-50 small mb-2">RÃ©partition (admis / Ã©chec / non saisi)</div>
                <canvas id="chartDist" height="180"></canvas>
            </div>
        </div>

        <div class="table-responsive mt-4">
            <table class="table table-dark table-sm mb-0 align-middle">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Nom</th>
                        <th>Classe</th>
                        <th>Moyenne</th>
                    </tr>
                </thead>
                <tbody>
                    {% for e in top_eleves %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ e.nom }}</td>
                        <td>{{ e.niveau }}</td>
                        <td class="fw-bold">{{ e.moyenne }}</td>
                    </tr>
                    {% else %}
                    <tr><td colspan="4" class="text-center text-white-50 py-3">Aucun rÃ©sultat</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

<div class="card shadow-sm mb-4 border-0" style="background-color: #1e1e1e; border-radius: 10px;">
    <div class="card-body py-3 px-3">
        <form action="/" method="get">
    <div class="row g-2 align-items-end">
        <div class="col-6 col-lg-2">
            <label class="small text-white-50">Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
            <select name="trimestre" class="form-select form-select-sm bg-dark text-white border-secondary" onchange="this.form.submit()">
                <option value="1" {% if trimestre == '1' %}selected{% endif %}>T1</option>
                <option value="2" {% if trimestre == '2' %}selected{% endif %}>T2</option>
                <option value="3" {% if trimestre == '3' %}selected{% endif %}>T3</option>
            </select>
        </div>
        <div class="col-6 col-lg-2">
            <label class="small text-white-50">Ø§Ù„Ù‚Ø³Ù…</label>
            <select name="niveau" class="form-select form-select-sm bg-dark text-white border-secondary" onchange="this.form.submit()">
                <option value="all">Ø§Ù„ÙƒÙ„</option>
                {% for classe in liste_classes %}<option value="{{ classe }}" {% if niveau_actuel == classe %}selected{% endif %}>{{ classe }}</option>{% endfor %}
            </select>
        </div>
        <div class="col-12 col-lg-6">
            <label class="small text-white-50">Ø¨Ø­Ø«</label>
            <input type="text" name="recherche" value="{{ recherche_actuelle }}" class="form-control form-control-sm bg-dark text-white border-secondary" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØªÙ„Ù…ÙŠØ°..." />
        </div>
        <div class="col-12 col-lg-2 d-flex gap-1 justify-content-end">
            <button type="submit" class="btn btn-sm btn-outline-info"><i class="bi bi-search"></i></button>
            <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#addStudentModal"><i class="bi bi-person-plus-fill"></i></button>
            <button class="btn btn-sm btn-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#importBox"><i class="bi bi-file-earmark-spreadsheet-fill"></i></button>
        </div>
    </div>

    <div class="row g-2 align-items-end mt-2">
        <div class="col-12 col-md-4">
            <label class="small text-white-50">Tri</label>
            <select name="sort" class="form-select form-select-sm bg-dark text-white border-secondary" onchange="this.form.submit()">
                <option value="class" {% if sort == 'class' %}selected{% endif %}>Classe</option>
                <option value="name" {% if sort == 'name' %}selected{% endif %}>Nom</option>
                <option value="moy" {% if sort == 'moy' %}selected{% endif %}>Moyenne</option>
                <option value="id" {% if sort == 'id' %}selected{% endif %}>ID</option>
            </select>
        </div>
        <div class="col-6 col-md-2">
            <label class="small text-white-50">Ordre</label>
            <select name="order" class="form-select form-select-sm bg-dark text-white border-secondary" onchange="this.form.submit()">
                <option value="asc" {% if order == 'asc' %}selected{% endif %}>Asc</option>
                <option value="desc" {% if order == 'desc' %}selected{% endif %}>Desc</option>
            </select>
        </div>
        <div class="col-6 col-md-2">
            <label class="small text-white-50">Par page</label>
            <select name="per_page" class="form-select form-select-sm bg-dark text-white border-secondary" onchange="this.form.submit()">
                <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
                <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
            </select>
        </div>
        <div class="col-12 col-md-4">
            <label class="small text-white-50">Etat</label>
            <select name="etat" class="form-select form-select-sm bg-dark text-white border-secondary" onchange="this.form.submit()">
                <option value="all" {% if etat == 'all' %}selected{% endif %}>Tous</option>
                <option value="admis" {% if etat == 'admis' %}selected{% endif %}>Admis (>=10)</option>
                <option value="echec" {% if etat == 'echec' %}selected{% endif %}>Echec (<10)</option>
                <option value="non_saisi" {% if etat == 'non_saisi' %}selected{% endif %}>Non saisi</option>
            </select>
        </div>
    </div>

    <div class="row g-2 align-items-end mt-2">
        <div class="col-6 col-md-2">
            <label class="small text-white-50">Min moy</label>
            <input type="number" step="0.01" name="min_moy" value="{{ min_moy if min_moy is not none else '' }}" class="form-control form-control-sm bg-dark text-white border-secondary" onchange="this.form.submit()">
        </div>
        <div class="col-6 col-md-2">
            <label class="small text-white-50">Max moy</label>
            <input type="number" step="0.01" name="max_moy" value="{{ max_moy if max_moy is not none else '' }}" class="form-control form-control-sm bg-dark text-white border-secondary" onchange="this.form.submit()">
        </div>
        <div class="col-12 col-md-8 d-flex justify-content-end">
            <div class="text-white-50 small mt-2 mt-md-0">Total: {{ total }}</div>
        </div>
    </div>
</form>

    </div>
    <div class="collapse" id="importBox">
        <div class="card-footer bg-dark border-top border-secondary p-3">
             <form action="/import_excel" method="post" enctype="multipart/form-data" class="d-flex gap-2 align-items-center">
                {{ csrf_field() }}
                <input class="form-control form-control-sm bg-dark text-white border-secondary" type="file" name="fichier_excel" accept=".xlsx, .xls" required>
                <input type="hidden" name="trimestre_import" value="{{ trimestre }}">
                <button type="submit" class="btn btn-sm btn-success">Import</button>
            </form>
        </div>
    </div>
</div>

<form action="/sauvegarder_tout" method="POST" id="formSaveAll">
                {{ csrf_field() }}
    <input type="hidden" name="trimestre_save" value="{{ trimestre }}">
    <div class="card shadow-sm border-0" style="background-color: transparent;">
        <div class="card-header bg-dark border-bottom border-secondary d-flex justify-content-between align-items-center py-2 px-3 rounded-top">
            <h6 class="mb-0 text-white">{% if niveau_actuel and niveau_actuel != 'all' %}Ù‚Ø³Ù…: <span class="text-primary">{{ niveau_actuel }}</span>{% else %}Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°{% endif %}</h6>
            <div class="d-flex gap-1">
                <button type="submit" class="btn btn-sm btn-primary px-3">ğŸ’¾ Ø­ÙØ¸</button>
                <button type="button" class="btn btn-sm btn-warning text-dark px-3" data-bs-toggle="modal" data-bs-target="#fillOfficialModal">âš¡ Ø§Ù„Ø±Ø³Ù…ÙŠ</button>
                <div class="dropdown">
                    <button class="btn btn-sm btn-secondary dropdown-toggle px-2" type="button" data-bs-toggle="dropdown">âš™ï¸</button>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark shadow">
                        <li><a class="dropdown-item" href="{{ url_for('main.print_list', trimestre=trimestre, niveau=niveau_actuel, recherche=recherche_actuelle, sort=sort, order=order, min_moy=min_moy, max_moy=max_moy, etat=etat) }}" target="_blank">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© (PDF)</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('main.export_excel', trimestre=trimestre, niveau=niveau_actuel, recherche=recherche_actuelle, sort=sort, order=order, min_moy=min_moy, max_moy=max_moy, etat=etat) }}">â¬‡ ØªØ­Ù…ÙŠÙ„ Excel</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#" onclick="submitDelete()">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†</a></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="table-responsive">
            <table class="table table-dark table-hover mb-0 align-middle" style="min-width: 600px;">
                <thead>
                    <tr style="border-bottom: 2px solid var(--accent-color); background-color: #151515;">
                        <th class="text-center p-2" style="width: 80px;">
  <input type="checkbox" class="form-check-input" onclick="toggle(this)" title="Tout sÃ©lectionner">
</th>
                        <th class="text-white p-2">#</th>
                        <th class="text-white p-2" style="min-width: 160px;">Ø§Ù„Ù„Ù‚Ø¨ Ùˆ Ø§Ù„Ø§Ø³Ù…</th>
                        <th class="text-center text-white-50 p-2">Ø§Ù„Ù†Ø´Ø§Ø·</th>
                        <th class="text-center text-white-50 p-2">Ø§Ù„ÙØ±Ø¶</th>
                        <th class="text-center text-white-50 p-2">Ø§Ù„Ø¥Ø®ØªØ¨Ø§Ø±</th>
                        <th class="text-center text-primary p-2">Ø§Ù„Ù…Ø¹Ø¯Ù„</th>
                        <th class="text-white-50 p-2" style="min-width: 150px;">Ø§Ù„ØªÙ‚Ø¯ÙŠØ±Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    {% for eleve in eleves %}
                    <tr style="border-bottom: 1px solid #333;">
                        <td class="text-center d-flex gap-2 justify-content-center pt-3">
                            <input type="checkbox" name="ids_delete" value="{{ eleve.id }}" class="form-check-input check-delete">
                            <input type="hidden" name="id_eleve" value="{{ eleve.id }}">
                            <a href="/bulletin/{{ eleve.id }}?trimestre={{ trimestre }}" target="_blank" class="btn btn-sm btn-outline-info py-0 px-1" title="Imprimer Bulletin" style="height: 25px;"><i class="bi bi-file-text"></i></a>
                        </td>
                        <td class="text-white fw-bold">{{ ((page - 1) * per_page) + loop.index }}</td>
                        <td class="fw-bold text-white">{{ eleve.nom_complet }}<br><span class="badge bg-secondary text-white border border-dark mt-1" style="font-size: 0.65em;">{{ eleve.niveau }}</span></td>
                        <td class="p-1"><input type="number" step="0.01" min="0" max="20" id="act_{{eleve.id}}" name="activite" value="{{ eleve.activite }}" class="form-control input-note" oninput="calculLive({{eleve.id}})"></td>
                        <td class="p-1"><input type="number" step="0.01" min="0" max="20" id="dev_{{eleve.id}}" name="devoir" value="{{ eleve.devoir }}" class="form-control input-note" oninput="calculLive({{eleve.id}})"></td>
                        <td class="p-1"><input type="number" step="0.01" min="0" max="20" id="comp_{{eleve.id}}" name="compo" value="{{ eleve.compo }}" class="form-control input-note" oninput="calculLive({{eleve.id}})"></td>
                        <td class="text-center fw-bold fs-5"><span id="moy_{{eleve.id}}" class="{% if eleve.moyenne < 10 %}text-danger{% else %}text-success{% endif %}">{{ eleve.moyenne }}</span></td>
                        <td class="small text-white-50 text-truncate" style="max-width: 150px;">{{ eleve.remarques }}</td>
                    </tr>
                    {% else %}
                    <tr><td colspan="9" class="text-center py-5 text-white">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if pages > 1 %}
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 py-2 px-2 bg-dark border-top border-secondary">
            <div class="text-white-50 small">Page {{ page }} / {{ pages }} â€¢ {{ total }} Ã©lÃ¨ves</div>
            <nav aria-label="Pagination">
                <ul class="pagination pagination-sm mb-0">
                    <li class="page-item {% if page <= 1 %}disabled{% endif %}">
                        <a class="page-link" href="{{ url_for('main.index', trimestre=trimestre, niveau=niveau_actuel, recherche=recherche_actuelle, sort=sort, order=order, per_page=per_page, min_moy=min_moy, max_moy=max_moy, etat=etat, page=page-1) }}">Â«</a>
                    </li>

                    {% set start = 1 if page - 2 < 1 else page - 2 %}
                    {% set end = pages if page + 2 > pages else page + 2 %}
                    {% for p in range(start, end + 1) %}
                        <li class="page-item {% if p == page %}active{% endif %}">
                            <a class="page-link" href="{{ url_for('main.index', trimestre=trimestre, niveau=niveau_actuel, recherche=recherche_actuelle, sort=sort, order=order, per_page=per_page, min_moy=min_moy, max_moy=max_moy, etat=etat, page=p) }}">{{ p }}</a>
                        </li>
                    {% endfor %}

                    <li class="page-item {% if page >= pages %}disabled{% endif %}">
                        <a class="page-link" href="{{ url_for('main.index', trimestre=trimestre, niveau=niveau_actuel, recherche=recherche_actuelle, sort=sort, order=order, per_page=per_page, min_moy=min_moy, max_moy=max_moy, etat=etat, page=page+1) }}">Â»</a>
                    </li>
                </ul>
            </nav>
        </div>
        {% endif %}
    </div>
</form> 

<form action="/supprimer_multi" method="POST" id="formMultiDelete" style="display:none;">
                {{ csrf_field() }}</form>

<div class="modal fade" id="fillOfficialModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background-color: #2d2d2d; color: white;">
      <div class="modal-header border-secondary bg-warning text-dark"><h5 class="modal-title fw-bold">âš¡ Ù…Ù„Ø¡ Ù…Ù„Ù Ø§Ù„Ù…Ø¯ÙŠØ±</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <form action="/remplir_bulletin_officiel" method="POST" enctype="multipart/form-data">
                {{ csrf_field() }}
          <div class="modal-body text-center p-4"><p class="text-white-50 mb-3">Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„ Ø§Ù„ÙØ§Ø±Øº.</p><input type="hidden" name="trimestre_fill" value="{{ trimestre }}"><input type="file" class="form-control bg-dark text-white border-secondary" name="fichier_vide" accept=".xlsx" required></div>
          <div class="modal-footer border-secondary justify-content-center"><button type="submit" class="btn btn-warning w-75 fw-bold">Ù…Ù„Ø¡ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</button></div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="addStudentModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background-color: #2d2d2d; color: white;">
      <div class="modal-header border-secondary"><h5 class="modal-title text-success">Ø¥Ø¶Ø§ÙØ© ØªÙ„Ù…ÙŠØ°</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
      <form action="/ajouter_eleve" method="POST">
                {{ csrf_field() }}
          <div class="modal-body p-4">
            <input type="hidden" name="trimestre_ajout" value="{{ trimestre }}">
            <div class="mb-3"><label class="form-label small text-white-50">Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨</label><input type="text" class="form-control bg-dark text-white border-secondary" name="nom_complet" placeholder="Ex: Benali Mohamed" required></div>
            <div class="mb-3"><label class="form-label small text-white-50">Ø§Ù„Ù‚Ø³Ù…</label><input type="text" class="form-control bg-dark text-white border-secondary" name="niveau" placeholder="Ex: 4M2" required list="classes_list"><datalist id="classes_list">{% for classe in liste_classes %}<option value="{{ classe }}">{% endfor %}</datalist></div>
            <div class="row g-2">
                <div class="col-4"><input type="number" step="0.01" class="form-control bg-dark text-white border-secondary text-center" name="activite" placeholder="Act"></div>
                <div class="col-4"><input type="number" step="0.01" class="form-control bg-dark text-white border-secondary text-center" name="devoir" placeholder="Dev"></div>
                <div class="col-4"><input type="number" step="0.01" class="form-control bg-dark text-white border-secondary text-center" name="compo" placeholder="Ex"></div>
            </div>
          </div>
          <div class="modal-footer border-secondary justify-content-center"><button type="submit" class="btn btn-success w-75 fw-bold">Ø­ÙØ¸</button></div>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
    {% if eleves %}
    (function() {
        const data = {{ chart_data|safe }};
        const ctxClasses = document.getElementById('chartClasses');
        const ctxDist = document.getElementById('chartDist');

        if (ctxClasses) {
            new Chart(ctxClasses, {
                type: 'bar',
                data: {
                    labels: data.classes.labels,
                    datasets: [{
                        label: 'Moyenne',
                        data: data.classes.values,
                        backgroundColor: '#0d6efd'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, max: 20 } }
                }
            });
        }

        if (ctxDist) {
            new Chart(ctxDist, {
                type: 'doughnut',
                data: {
                    labels: data.distribution.labels,
                    datasets: [{
                        data: data.distribution.values,
                        backgroundColor: ['#198754', '#dc3545', '#6c757d']
                    }]
                },
                options: { responsive: true }
            });
        }
    })();
    {% endif %}
</script>

<script>
    function calculLive(id) {
        var actInput = document.getElementById('act_' + id); var devInput = document.getElementById('dev_' + id); var compInput = document.getElementById('comp_' + id); var moySpan = document.getElementById('moy_' + id);
        checkMax(actInput); checkMax(devInput); checkMax(compInput);
        var act = parseFloat(actInput.value) || 0; var dev = parseFloat(devInput.value) || 0; var comp = parseFloat(compInput.value) || 0;
        var moyenne = ((dev + act) / 2 + (comp * 2)) / 3;
        moySpan.innerText = moyenne.toFixed(2);
        if (moyenne < 10) { moySpan.className = 'text-danger fw-bold fs-5'; } else { moySpan.className = 'text-success fw-bold fs-5'; }
    }
    function checkMax(input) { if(input.value > 20) { input.value = 20; input.style.borderColor = 'red'; setTimeout(function(){ input.style.borderColor = '#444'; }, 500); } if(input.value < 0) { input.value = 0; } }
    function toggle(source) { checkboxes = document.querySelectorAll('.check-delete'); for(var i=0, n=checkboxes.length;i<n;i++) { checkboxes[i].checked = source.checked; } }
    function submitDelete() {
        if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) return;
        var formDelete = document.getElementById('formMultiDelete');
        var csrfInputExisting = formDelete.querySelector('input[name=\'csrf_token\']');
        var csrfVal = csrfInputExisting ? csrfInputExisting.value : null;
        formDelete.innerHTML = '';
        if (csrfVal) {
            var csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrf_token';
            csrfInput.value = csrfVal;
            formDelete.appendChild(csrfInput);
        }
        
        var checkboxes = document.querySelectorAll('.check-delete:checked');
        if(checkboxes.length === 0) { alert('Ø­Ø¯Ø¯ ØªÙ„Ù…ÙŠØ°'); return; }
        checkboxes.forEach(function(chk) { var input = document.createElement('input'); input.type = 'hidden'; input.name = 'ids'; input.value = chk.value; formDelete.appendChild(input); });
        formDelete.submit();
    }
</script>

{% endblock %}
